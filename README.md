# Задание 1 — найди ошибки

В этом репозитории находятся материалы тестового задания "Найди ошибки" для [14-й Школы разработки интерфейсов](https://academy.yandex.ru/events/frontend/shri_msk-2018-2) (осень 2018, Москва, Санкт-Петербург, Симферополь).

Для работы тестового приложения нужен Node.JS v9. В проекте используются [Yandex Maps API](https://tech.yandex.ru/maps/doc/jsapi/2.1/quick-start/index-docpage/) и [ChartJS](http://www.chartjs.org).

## Задание

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1. Приложение должно успешно запускаться.
1. По адресу http://localhost:9000 должна открываться карта с метками.
1. Должна правильно работать вся функциональность, перечисленная в условиях задания.
1. Не должно быть лишнего кода.
1. Все должно быть в едином codestyle.

## Запуск

```
npm i
npm start
```

При каждом запуске тестовые данные генерируются заново случайным образом.

## Ход решения задачи
### 1. Инициализация. [ commit ](https://github.com/GyGaByyyTe/task_1/commit/b3db02cf0b612aab7af2ec7e154f59a3293244c1) 

 Оказалось, сначала необходимо было добиться успешной инициализации карты. При первом запуске, webpack дал понять, что не может найти функцию `initMap`. Проблема в синтаксисе импорта. 
 
 **Решение -** либо имя функции надо обернуть в фигурные скобки, либо в импортируемом модуле добавить ключевое слово `deafult`. Я выбрал первый вариант, чтобы сохранить во всех модулях единый стиль импорта функций. 
 
 В этом же коммите VSCode помог немного стандартизировать кавычки,табуляции и отступы.

### 2. Отображение карты и позиционирование.  [ commit ](https://github.com/GyGaByyyTe/task_1/commit/488cda299b0f921fa55f14048f06b2676c2395c7)

Добившись заветного **inited** в консоли, я понял, что карта имеет нулевую высоту. Сначала, следуя примеру из документации, задал стили непосредственно тегу `div`, но затем, вынес размеры блока в файл со стилями. Карта стала отображаться на все окно браузера.

Но появилась другая проблема - точки на карте не видны. После сверки кода с примерами из документации, было понятно - объекты, загруженные в `objectManager`, не добавлены в саму карту. Ну, теперь то всё должно работать. 

Но где же точки, ведь теперь все написано правильно!? Спустя некоторое время и пару запросов в поисковик (как сторонний инструмент), была найдена похожая проблема у парня в 2015 году - его точки тогда отображались в Иране. Отдаляю свою карту - то же самое. 

**Решение:** меняем широту и долготу местами в маппере.
(*сhart.js можно было не переименовывать, это была дань VSCode*)

### 3. Всплывающее окно над станцией. [ commit ](https://github.com/GyGaByyyTe/task_1/commit/021d1d0d6706834230b9bcd2d558b41b7fbe4198)

Следующая проблема - при клике на станцию, пустая всплывашка показывается в углу, а при повторном нажатии выбрасывает ошибку в консоль, сообщая о невозможности уничтожить несуществующий объект. 
 
Сначала подумал - я не очень знаком со спецификой <span style="color:red">Я</span>ндекс.Карт, вдруг незакрытый `<div>` в шаблоне всему виной? Но нет, проблема не устранена. *Город засыпает*. Со свежей головой, прочесав и сравнив все варианты в документации с исходным кодом, я пришел к выводу - что проблема в стрелочной функции в методах `build` и `clear`. Банальный `console.log(this)` выдает `undefinded` в момент создания баллуна по клику на метку. 

**Решение:** меняем контекст <span style="color:blue">**this**</span>, для этого заменяем стрелочные функции в переопределении методов `build` и `clear` на *function expression*, как в документации.

### 4. График активности. [ commit ](https://github.com/GyGaByyyTe/task_1/commit/d234e1f3902a913a8b1ac8f3a6cd4987981321e9) 

Теперь popup отображается, но странно - на активных точках график пустой, на дефектных - видны только точки, значение которых 0. И странно то, что значения по оси ординат отрицательные, ведь не может же быть подключено -0.5 дронов?)) 

Ознакомившись с документацией **Chart.js**, вижу параметр `yAxes`, отвечающий за диапазон значений оси ординат. Судя по всему, мои программисты допустили опечатку. 

**Решение:** меняем 0 на 10, и графики работащих станций растут прямо на глазах (буквально).

### 5. Сегментация кластера. [ commit ](https://github.com/GyGaByyyTe/task_1/commit/b446b8c041f4e3ea03834edf899c17a962fbe156) 

Все почти готово, осталось сделать так, чтобы по кластеру было понятно, есть ли в нем одновременно исправные и неисправные точки. Такое поведение, как оказалось, по умолчанию есть в кластеризаторе. А меня от такого поведения отделяет всего одна строка - `objectManager.clusters.options.set('preset', 'islands#greenClusterIcons');`, которая красит все кластеры в красивый зеленый цвет, но мешает корректному отображению данных.

**Решение:** удаляем лишнюю строку, меняющую пресет кластера.

<pre>
.∧＿∧
( ･ω･｡)つ━☆・*。
⊂. ノ ...・゜+.
しーＪ...°。+ *´¨)
..........· ´¸.·*´¨) ¸.·*¨)
..........(¸.·´ (¸.·'* ☆ ВЖУХ, и все работает.
</pre>
P.S. Следующие два коммита содержат стилизационные исправления, унифицирующие кавычки и отступы. (*импорт методов менял зря, не обращайте внимания*)